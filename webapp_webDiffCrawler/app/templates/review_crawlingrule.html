{% extends "base.html" %}

{% block title %}
    Rule {{ rule['id_crawlingrules'] }} - {{ rule['address'] }}
{% endblock %}

{% block page_content %}

<div class="row">
    <h1 class="col-lg-11">
        Review crawling rule id {{ rule['id_crwalingrule'] }}
    </h1>

    <div class="col-lg-1">
        <br>
        <form action="{{url_for('.deleteACrawlingRule')}}" method="POST">
            <input id="deleteCrawlingRule" name="deleteCrawlingRuleId" type="hidden"
                   value="{{rule['id_crawlingrules']}}">
            <button class="btn btn-danger" type="submit">Delete</button>
        </form>
    </div>
</div>

<div class="row">
    <div class="col-lg-6">
        <table class="table">
          <tbody>
            <tr>
                <th scope="row">Description</th>
                <td>{{ rule['description'] }}</td>
            </tr>
            <tr>
                <th scope="row">Address</th>
                <td><a href="{{ rule['address'] }}">{{ rule['address'] }}</a></td>
            </tr>
            <tr>
                <th scope="row">Selection rule</th>
                <td>{{ rule['selectionrule'] }}</td>
            </tr>
            <tr>
                <th scope="row">Check every</th>
                <td>{{ rule['crawlperiod'] }} m</td>
            </tr>
            <tr>
                <th scope="row">Last update time</th>
                <td>{{ rule['lastmodifytimestr'] }}</td>
            </tr>
            <tr>
                <th scope="row">Last check time</th>
                <td>{{ rule['lastcrawltimestr'] }}</td>
            </tr>
          </tbody>
        </table>
    </div>
</div>

<div class="row">
    <div class="panel panel-info">

            <button class="btn btn-info btn-block" type="button" data-toggle="collapse" data-target="#allContent" aria-expanded="true" aria-controls="allContent">
                <div class="panel-heading">
                    <h4>Latest content</h4>
                </div>
            </button>



        <div class="panel-body collapse in" id="allContent">

            <div class="row">
                {% if rule['docslinks'] %}
                    <h4>Documents download links:</h4>
                    <ul>
                        {% for documentAnchor in rule["currdocslinks"] %}
                            <li>
                                {{ documentAnchor | safe }}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <h4>No documents download links</h4>
                {% endif %}
            </div>

            <div class="row">
                <div class="col-8 col-centered multiline" id="new-content">
                    {{ rule["content"] | string | safe }}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <h3><u>Generated notifications</u>:</h3>
</div>

<div class="row">
    <div class="mytable">
        <table class="table table-hover table-responsive">
            <thead>
                <th scope="col">Notification ID</th>
                <th scope="col">Description</th>
                <th scope="col">Selector</th>
                <th scope="col">Time</th>
                <th scope="col"></th>
                <th scope="col">Acknowledge</th>
                <th scope="col">
                    <form id="ackChecked" action="{{url_for('.ackNotifications')}}" method="POST">
                        <button class="btn btn-success" type="submit">Acknowledge checked</button>
                    </form>
                </th>
            </thead>
            <tbody>
                {% for notif in notifications %}
                    <tr>
                        <td>{{notif['id_notifications']}}</td>
                        <td>{{notif['ruleDescription']}}</td>
                        <td>{{notif['matchingrule']}}</td>
                        <td>{{notif['modifytimestr']}}</td>
                        <td>
                            <form action="{{url_for('.reviewNotification', id_notifications=notif['id_notifications'])}}"
                                  method="GET">
                                <button class="btn btn-info">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </form>
                        </td>
                        <td>
                            <form action="{{url_for('.ackANotification')}}" method="POST">
                                <input id="ackNotification" name="ackNotificationId" type="hidden"
                                       value="{{notif['id_notifications']}}">
                                <button class="btn btn-success" type="submit">Acknowledge</button>
                            </form>
                        </td>
                        <td>
                            <input form="ackChecked" type="checkbox" name='ack_checkbox'
                                   value = "{{notif['id_notifications']}}">
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>



{% endblock %}
