{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}
    {{ super() }}
    - Modify Crawling Rules
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        let iframeElement = $("#preview-iframe")
        let addressInput = $(".form input[name=address]")
        iframeElement.attr("src", addressInput.val()) // Take the initial value found in the form input
        addressInput.on("input", function() {
            console.log("addressInput changed")
            iframeElement.attr("src", addressInput.val()) // Update the iframe src everytime the input changes
            // iframeElement.attr("src", "test")

        })
    </script>
{% endblock %}

{% block page_content %}
<div class="page-header">
    <h1>Add or delete crawling rules</h1>
</div>

<div class="row">
    <h2>
        Existing crawling rules:
    </h2>
    <div class="mytable">
        <table class="table table-hover table-responsive">
            <thead>
                <th scope="col">ID</th>
                <th scope="col">Webpage</th>
                <th scope="col">Selector</th>
                <th scope="col">Delete</th>
                <th scope="col">
                    <form id="deleteChecked" action="{{url_for('deleteCrawlingRules')}}" method="POST">
                        <button type="submit">Delete checked</button>
                    </form>
                </th>
            </thead>
            <tbody>
                {% for rule in crawlingRules %}
                    <tr>
                        <td>{{rule['id_crawlingrules']}}</td>
                        <td>{{rule['address']}}</td>
                        <td>{{rule['selectionrule']}}</td>
                        <td>
                            <form action="{{url_for('deleteACrawlingRule')}}" method="POST">
                                <input id="deleteCrawlingRule" name="deleteCrawlingRuleId" type="hidden"
                                       value="{{rule['id_crawlingrules']}}">
                                <button type="submit">Delete</button>
                            </form>
                        </td>
                        <td>
                            <input form="deleteChecked" type="checkbox" name='delete_checkbox'
                                   value = "{{rule['id_crawlingrules']}}">
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="row">
    <h2>
        Add a new crawling rule:
    </h2>
</div>

<div class="row">
    <div class="col-lg-9 embed-responsive embed-responsive-16by9">
        <iframe class="embed-responsive-item" id="preview-iframe" src="">

        </iframe>
    </div>
    <div class="col-lg-3">
        {{ wtf.quick_form(crawlingRuleForm, action=url_for('crawlingRules')) }}
    </div>
</div>

{% endblock %}